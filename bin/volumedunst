#!/usr/bin/env ksh

# You can call this script like this:
# $ ./volumedunst.sh up
# $ ./volumedunst.sh down
# $ ./volumedunst.sh mute

# Script modified from these wonderful people:
# https://github.com/dastorm/volume-notification-dunst/blob/master/volume.sh
# https://gist.github.com/sebastiencs/5d7227f388d93374cebdf72e783fbd6a

get_volume() {
	pamixer --get-volume
}

is_mute() {
	pamixer --get-mute
}

send_notification() {
	if $(is_mute); then
		icon="audio-volume-muted"
		message="mute"
	else
		volume=$(get_volume)
		bar=$(printf 'â”€%.0s' $(seq -s ' ' 1 $((volume / (6 / 2.7)))))
		icon="audio-volume-medium-symbolic"
		message="$bar"
	fi

	dunstify -i "$icon" -r 5555 -u normal "$message"
}

case $1 in
	up | down)
		pamixer -u
		[[ "$1" = "up" ]] && pamixer -i 10 || pamixer -d 10
		send_notification
		;;
	mute)
		pamixer -t
		send_notification
		;;
	mic_mute)
		pamixer --default-source -t
		dunstify -r 2593 -u normal "micro mute"
		;;
esac
